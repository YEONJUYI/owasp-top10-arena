<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <title>ëŒ€ì‹œë³´ë“œ - JWTBank</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:#0d1117; color:#c9d1d9; font-family:'Courier New',monospace; }

    nav {
      background:#161b22; padding:16px 32px;
      display:flex; justify-content:space-between; align-items:center;
      border-bottom:1px solid #30363d;
    }
    nav .logo { color:#ec4899; font-size:1.2rem; font-weight:bold; }
    nav .nav-right { display:flex; align-items:center; gap:20px; }
    nav .user-badge { font-size:0.8rem; color:#8b949e; }
    nav .user-badge b { color:#ec4899; }
    nav a { color:#8b949e; text-decoration:none; font-size:0.8rem; }
    nav a:hover { color:#f85149; }

    .hero { text-align:center; padding:48px 20px 32px; }
    .badge {
      display:inline-block; background:#1f2937;
      border:1px solid #ec4899; color:#ec4899;
      padding:4px 12px; border-radius:9999px;
      font-size:0.72rem; margin-bottom:16px;
    }
    .hero h1 { font-size:1.5rem; color:#f0f6fc; margin-bottom:8px; }
    .hero p { color:#8b949e; font-size:0.82rem; }

    .container { max-width:640px; margin:0 auto; padding:0 24px 60px; }

    .card {
      background:#161b22; border:1px solid #30363d;
      border-radius:8px; overflow:hidden; margin-bottom:20px;
    }
    .card-header {
      padding:14px 20px; border-bottom:1px solid #21262d;
      font-size:0.85rem; color:#f0f6fc; font-weight:bold;
    }
    .card-body { padding:20px; }

    .profile-row {
      display:flex; justify-content:space-between;
      padding:9px 0; border-bottom:1px solid #21262d; font-size:0.83rem;
    }
    .profile-row:last-child { border-bottom:none; }
    .profile-label { color:#8b949e; }
    .profile-value { color:#f0f6fc; }
    .tag {
      background:#1f2937; border:1px solid #30363d;
      color:#8b949e; padding:2px 8px;
      border-radius:4px; font-size:0.72rem;
    }

    /* JWT í† í° ë·°ì–´ */
    .token-viewer { font-size:0.78rem; line-height:1.9; }
    .token-viewer .token-raw {
      background:#010409; border:1px solid #21262d;
      border-radius:6px; padding:12px 14px;
      word-break:break-all; margin-bottom:14px;
      font-size:0.75rem; color:#8b949e;
    }
    .token-part-header  { color:#ec4899; }
    .token-part-payload { color:#f59e0b; }
    .token-part-sig     { color:#3fb950; }

    .token-decoded {
      display:grid; grid-template-columns:1fr 1fr; gap:10px;
    }
    .token-section {
      background:#010409; border:1px solid #21262d;
      border-radius:6px; padding:10px 12px;
    }
    .token-section .label {
      font-size:0.72rem; margin-bottom:6px; font-weight:bold;
    }
    .token-section.header .label { color:#ec4899; }
    .token-section.payload .label { color:#f59e0b; }
    .token-section pre {
      font-size:0.75rem; color:#8b949e; white-space:pre-wrap; word-break:break-all;
    }

    /* íŒíŠ¸ */
    .hint-box {
      background:#1a0818; border:1px solid #9d174d;
      border-radius:8px; padding:16px 20px;
      font-size:0.82rem; color:#f9a8d4; line-height:1.9;
    }
    .hint-box b { color:#f9a8d4; }
    .hint-box code {
      background:#0d1117; color:#f9a8d4;
      padding:1px 6px; border-radius:4px; font-size:0.78rem;
    }
  </style>
</head>
<body>

<nav>
  <span class="logo">ğŸ”‘ JWTBank</span>
  <div class="nav-right">
    <span class="user-badge">logged in as <b>{{ user }}</b></span>
    <a href="/logout">logout</a>
  </div>
</nav>

<div class="hero">
  <div class="badge">A07 Â· Authentication Failures</div>
  <h1>ë‚´ ëŒ€ì‹œë³´ë“œ</h1>
  <p>ì¼ë°˜ ì‚¬ìš©ì ê¶Œí•œìœ¼ë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
</div>

<div class="container">

  <!-- ê³„ì • ì •ë³´ -->
  <div class="card">
    <div class="card-header">ğŸ‘¤ ë‚´ ê³„ì • ì •ë³´</div>
    <div class="card-body">
      <div class="profile-row">
        <span class="profile-label">Username</span>
        <span class="profile-value">{{ user }}</span>
      </div>
      <div class="profile-row">
        <span class="profile-label">Role</span>
        <span class="profile-value"><span class="tag">{{ role }}</span></span>
      </div>
      <div class="profile-row">
        <span class="profile-label">Admin Access</span>
        <span class="profile-value" style="color:#484f58;">ì ‘ê·¼ ë¶ˆê°€</span>
      </div>
    </div>
  </div>

  <!-- JWT í† í° ë·°ì–´ -->
  <div class="card">
    <div class="card-header">ğŸ« JWT Token Viewer</div>
    <div class="card-body token-viewer">
      <div class="token-raw" id="tokenRaw">í† í° ë¡œë”© ì¤‘...</div>
      <div class="token-decoded">
        <div class="token-section header">
          <div class="label">HEADER</div>
          <pre id="tokenHeader">{ }</pre>
        </div>
        <div class="token-section payload">
          <div class="label">PAYLOAD</div>
          <pre id="tokenPayload">{ }</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- íŒíŠ¸ -->
  <div class="hint-box">
    ğŸ’¡ <b>íŒíŠ¸:</b> JWTëŠ” <code>header.payload.signature</code> êµ¬ì¡°ë¡œ Base64URL ì¸ì½”ë”©ëœë‹¤.<br>
    headerì˜ <code>"alg"</code> ë¥¼ <code>"none"</code> ìœ¼ë¡œ, payloadì˜ <code>"role"</code> ì„ <code>"admin"</code> ìœ¼ë¡œ ë³€ì¡°í•˜ì.<br>
    ì„œëª…ì€ ë¹ˆ ë¬¸ìì—´ë¡œ ë‘ê³  (<code>header.payload.</code>) <code>curl -H "Authorization: Bearer &lt;token&gt;" http://localhost:5006/admin</code> ìœ¼ë¡œ ì ‘ê·¼í•˜ë¼.
  </div>

</div>

<script>
  // ì¿ í‚¤ì—ì„œ JWT í† í° ì½ì–´ì„œ íŒŒì‹± í›„ í‘œì‹œ
  function getCookie(name) {
    const m = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
    return m ? m.pop() : '';
  }

  function b64urlDecode(s) {
    s = s.replace(/-/g, '+').replace(/_/g, '/');
    while (s.length % 4) s += '=';
    try { return JSON.parse(atob(s)); } catch { return null; }
  }

  const token = getCookie('token');
  if (token) {
    const parts = token.split('.');
    // ìƒ‰ìƒ ê°•ì¡°
    document.getElementById('tokenRaw').innerHTML =
      `<span class="token-part-header">${parts[0]}</span>` +
      `<span style="color:#484f58">.</span>` +
      `<span class="token-part-payload">${parts[1]}</span>` +
      `<span style="color:#484f58">.</span>` +
      `<span class="token-part-sig">${parts[2]}</span>`;

    const header  = b64urlDecode(parts[0]);
    const payload = b64urlDecode(parts[1]);
    if (header)  document.getElementById('tokenHeader').textContent  = JSON.stringify(header,  null, 2);
    if (payload) document.getElementById('tokenPayload').textContent = JSON.stringify(payload, null, 2);
  } else {
    document.getElementById('tokenRaw').textContent = 'ì¿ í‚¤ì—ì„œ í† í°ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ';
  }
</script>

</body>
</html>