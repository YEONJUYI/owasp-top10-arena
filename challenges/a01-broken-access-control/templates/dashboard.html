<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - User Profile System</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #0d1117; color: #c9d1d9; font-family: 'Courier New', monospace; }

    nav {
      background: #161b22;
      padding: 16px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #30363d;
    }
    nav .logo { color: #58a6ff; font-size: 1.1rem; font-weight: bold; }
    nav .nav-right { display: flex; align-items: center; gap: 20px; }
    nav .user-badge {
      font-size: 0.8rem;
      color: #8b949e;
    }
    nav .user-badge b { color: #3fb950; }
    nav a { color: #8b949e; text-decoration: none; font-size: 0.8rem; }
    nav a:hover { color: #f85149; }

    .hero {
      text-align: center;
      padding: 48px 20px 32px;
    }
    .badge {
      display: inline-block;
      background: #1f2937;
      border: 1px solid #58a6ff;
      color: #58a6ff;
      padding: 4px 12px;
      border-radius: 9999px;
      font-size: 0.72rem;
      margin-bottom: 16px;
    }
    .hero h1 { font-size: 1.6rem; color: #f0f6fc; margin-bottom: 8px; }
    .hero p { color: #8b949e; font-size: 0.82rem; }

    .container { max-width: 640px; margin: 0 auto; padding: 0 24px 60px; }

    /* ë¯¸ì…˜ ë°•ìŠ¤ */
    .mission-box {
      background: #0d2149;
      border: 1px solid #1f4a8a;
      border-radius: 8px;
      padding: 20px 24px;
      margin-bottom: 24px;
      font-size: 0.85rem;
      line-height: 1.9;
    }
    .mission-box .title { color: #58a6ff; font-weight: bold; margin-bottom: 10px; font-size: 0.88rem; }
    .mission-box p { color: #8b949e; }
    .mission-box code {
      background: #0d1117;
      color: #79c0ff;
      padding: 1px 6px;
      border-radius: 4px;
      font-size: 0.82rem;
    }
    .mission-box b { color: #f0f6fc; }

    /* ì¹´ë“œ ê³µí†µ */
    .card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    .card-header {
      padding: 14px 20px;
      border-bottom: 1px solid #21262d;
      font-size: 0.85rem;
      color: #f0f6fc;
      font-weight: bold;
    }
    .card-body { padding: 20px; }

    /* í”„ë¡œí•„ í–‰ */
    .profile-row {
      display: flex;
      justify-content: space-between;
      padding: 9px 0;
      border-bottom: 1px solid #21262d;
      font-size: 0.83rem;
    }
    .profile-row:last-child { border-bottom: none; }
    .profile-label { color: #8b949e; }
    .profile-value { color: #f0f6fc; }
    .profile-secret { color: #484f58; font-style: italic; }

    /* POST ë²„íŠ¼ ì˜ì—­ */
    .api-section { font-size: 0.83rem; }
    .api-section p { color: #8b949e; margin-bottom: 14px; line-height: 1.7; }
    .api-section code {
      background: #0d1117;
      color: #79c0ff;
      padding: 1px 6px;
      border-radius: 4px;
      font-size: 0.8rem;
    }
    .btn-post {
      background: #1c2128;
      color: #58a6ff;
      border: 1px solid #1f4a8a;
      border-radius: 6px;
      padding: 10px 20px;
      font-family: 'Courier New', monospace;
      font-size: 0.83rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-post:hover { background: #1f2937; }

    /* API ì‘ë‹µ ì¹´ë“œ */
    .response-card {
      display: none;
      margin-top: 14px;
      background: #0d1117;
      border: 1px solid #21262d;
      border-radius: 6px;
      padding: 14px 16px;
      font-size: 0.82rem;
      line-height: 1.8;
    }
    .response-card .key { color: #8b949e; }
    .response-card .val { color: #f0f6fc; }
    .response-card .val-flag { color: #3fb950; font-weight: bold; }
    .response-card .val-admin { color: #f85149; }
    .response-loading { margin-top: 14px; color: #484f58; font-size: 0.8rem; }

    /* í”Œë˜ê·¸ ì œì¶œ */
    .flag-section { font-size: 0.83rem; }
    .flag-input-wrap { display: flex; gap: 10px; margin-top: 4px; }
    .flag-input-wrap input {
      flex: 1;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 9px 14px;
      color: #f0f6fc;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
    }
    .flag-input-wrap input:focus { outline: none; border-color: #3fb950; }
    .btn-submit {
      background: #0f2a1a;
      color: #3fb950;
      border: 1px solid #238636;
      border-radius: 6px;
      padding: 9px 18px;
      font-family: 'Courier New', monospace;
      font-size: 0.83rem;
      cursor: pointer;
      white-space: nowrap;
    }
    .btn-submit:hover { background: #1a3d28; }
    .flag-result { margin-top: 12px; font-size: 0.83rem; }
    .flag-correct {
      background: #0f2a1a;
      border: 1px solid #238636;
      border-radius: 6px;
      padding: 12px 16px;
      color: #3fb950;
    }
    .flag-wrong {
      background: #2d1515;
      border: 1px solid #f85149;
      border-radius: 6px;
      padding: 12px 16px;
      color: #f85149;
    }

    /* íŒíŠ¸ */
    .hint-box {
      background: #2d1e00;
      border: 1px solid #d97706;
      border-radius: 8px;
      padding: 14px 20px;
      font-size: 0.8rem;
      color: #f59e0b;
      line-height: 1.8;
    }
    .hint-box span { color: #d97706; font-weight: bold; }
  </style>
</head>
<body>

<nav>
  <span class="logo">ğŸ”“ User Profile System</span>
  <div class="nav-right">
    <span class="user-badge">logged in as <b>{{ user.username }}</b></span>
    <a href="/logout">logout</a>
  </div>
</nav>

<div class="hero">
  <div class="badge">A01 Â· Broken Access Control</div>
  <h1>ì‚¬ìš©ì í”„ë¡œí•„ ì‹œìŠ¤í…œ</h1>
  <p>OWASP Top 10 - A01: Broken Access Control (IDOR via POST body)</p>
</div>

<div class="container">

  <!-- ë¯¸ì…˜ -->
  <div class="mission-box">
    <div class="title">ğŸ¯ ë¯¸ì…˜</div>
    <p>
      í˜„ì¬ <b>{{ user.username }}</b> ìœ¼ë¡œ ë¡œê·¸ì¸ë˜ì–´ ìˆë‹¤.<br>
      í”„ë¡œí•„ ì¡°íšŒëŠ” <code>POST /api/profile</code> ìš”ì²­ìœ¼ë¡œ ì´ë£¨ì–´ì§€ë©°,<br>
      ìš”ì²­ bodyì— <code>{"user_id": {{ user.id }}}</code> ê°€ ë‹´ê¸´ë‹¤.<br><br>
      <b>Burp Suite</b> ë¡œ ì´ ìš”ì²­ì„ ê°€ë¡œì±„ <code>user_id</code> ë¥¼ ë³€ì¡°í•˜ì—¬<br>
      adminì˜ secret ì„ íƒˆì·¨í•˜ë¼.
    </p>
  </div>

  <!-- ë‚´ í”„ë¡œí•„ -->
  <div class="card">
    <div class="card-header">ğŸ“‹ Your Profile</div>
    <div class="card-body">
      <div class="profile-row">
        <span class="profile-label">ID</span>
        <span class="profile-value">{{ user.id }}</span>
      </div>
      <div class="profile-row">
        <span class="profile-label">Username</span>
        <span class="profile-value">{{ user.username }}</span>
      </div>
      <div class="profile-row">
        <span class="profile-label">Email</span>
        <span class="profile-value">{{ user.email }}</span>
      </div>
      <div class="profile-row">
        <span class="profile-label">Role</span>
        <span class="profile-value">{{ user.role }}</span>
      </div>
      <div class="profile-row">
        <span class="profile-label">Secret</span>
        <span class="profile-secret">{{ user.secret }}</span>
      </div>
    </div>
  </div>

  <!-- API í˜¸ì¶œ -->
  <div class="card">
    <div class="card-header">ğŸ“¡ POST /api/profile</div>
    <div class="card-body api-section">
      <p>
        ì•„ë˜ ë²„íŠ¼ì´ <code>POST /api/profile</code> ì„ í˜¸ì¶œí•œë‹¤.<br>
        <b>Burp Suite Intercept ON</b> ìƒíƒœì—ì„œ í´ë¦­ â†’<br>
        ìš”ì²­ bodyì˜ <code>user_id</code> ë¥¼ <code>1</code> ë¡œ ë³€ì¡° í›„ Forward.
      </p>
      <button class="btn-post" onclick="fetchProfile()" data-uid="{{ user.id }}">
        ğŸ“¤ POST /api/profile  { "user_id": {{ user.id }} }
      </button>
      <div id="loading" class="response-loading" style="display:none;">â³ ì‘ë‹µ ëŒ€ê¸° ì¤‘...</div>
      <div id="response-card" class="response-card"></div>
    </div>
  </div>

  <!-- í”Œë˜ê·¸ ì œì¶œ -->
  <div class="card">
    <div class="card-header">ğŸš© Flag Submit</div>
    <div class="card-body flag-section">
      <div class="flag-input-wrap">
        <input type="text" id="flag-input" placeholder="OWASP{...}">
        <button class="btn-submit" onclick="submitFlag()">SUBMIT</button>
      </div>
      <div id="flag-result" class="flag-result"></div>
    </div>
  </div>

  <!-- íŒíŠ¸ -->
  <div class="hint-box">
    <span>ğŸ’¡ íŒíŠ¸:</span>
    ì„œë²„ëŠ” ì„¸ì…˜ì´ ì•„ë‹Œ <b>ìš”ì²­ bodyì˜ user_id</b>ë¥¼ ê·¸ëŒ€ë¡œ ì‹ ë¢°í•œë‹¤.<br>
    Burp Suite â†’ Proxy â†’ Intercept is ON â†’ ë²„íŠ¼ í´ë¦­ â†’ body ìˆ˜ì • â†’ Forward
  </div>

</div>

<script>
  const MY_USER_ID = parseInt(document.querySelector('.btn-post').dataset.uid, 10);

  async function fetchProfile() {
    const loading = document.getElementById('loading');
    const card    = document.getElementById('response-card');

    loading.style.display = 'block';
    card.style.display    = 'none';
    card.innerHTML        = '';

    try {
      const res  = await fetch('/api/profile', {
        method:      'POST',
        headers:     { 'Content-Type': 'application/json' },
        body:        JSON.stringify({ user_id: MY_USER_ID }),
        credentials: 'include'
      });
      const data = await res.json();
      loading.style.display = 'none';

      if (data.error) {
        card.innerHTML = `<span style="color:#f85149">âš  ${data.error}</span>`;
        card.style.display = 'block';
        return;
      }

      const isAdmin  = data.role === 'Administrator';
      const flagHtml = isAdmin
        ? `<span class="val val-flag">${data.secret}</span>`
        : `<span class="val">${data.secret}</span>`;
      const roleHtml = isAdmin
        ? `<span class="val val-admin">${data.role}</span>`
        : `<span class="val">${data.role}</span>`;

      card.innerHTML = `
        <div><span class="key">id: </span><span class="val">${data.id}</span></div>
        <div><span class="key">username: </span><span class="val">${data.username}</span></div>
        <div><span class="key">email: </span><span class="val">${data.email}</span></div>
        <div><span class="key">role: </span>${roleHtml}</div>
        <div><span class="key">secret: </span>${flagHtml}</div>
        ${isAdmin ? '<div style="margin-top:10px; color:#3fb950;">âœ… admin ë°ì´í„° íƒˆì·¨ ì„±ê³µ! í”Œë˜ê·¸ë¥¼ ì œì¶œí•˜ë¼.</div>' : ''}
      `;
      card.style.display = 'block';

    } catch (e) {
      loading.style.display = 'none';
      card.innerHTML = `<span style="color:#f85149">ìš”ì²­ ì‹¤íŒ¨: ${e}</span>`;
      card.style.display = 'block';
    }
  }

  function submitFlag() {
    const input  = document.getElementById('flag-input').value.trim();
    const result = document.getElementById('flag-result');
    if (input === 'OWASP{p0st_b0dy_1d0r_pwn3d}') {
      result.innerHTML = `
        <div class="flag-correct">
          âœ… <b>Correct!</b> Challenge Cleared!<br>
          <span style="font-size:0.78rem; margin-top:4px; display:block; color:#8b949e;">
            POST bodyì˜ user_idë¥¼ ì‹ ë¢°í•˜ëŠ” IDOR ì·¨ì•½ì ì„ í†µí•´ admin ë°ì´í„°ë¥¼ íƒˆì·¨í–ˆë‹¤.
          </span>
        </div>`;
    } else {
      result.innerHTML = `<div class="flag-wrong">âŒ Wrong flag. Keep trying!</div>`;
    }
  }
</script>

</body>
</html>